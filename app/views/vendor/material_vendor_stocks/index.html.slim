- @end_day_stock = {}
- @previous_end_day_stock = {}

.clearfix
  h3 style='margin-top:0;float: left;' = "#{@vendors[0].company_name} 様"
.clearfix style='padding:5px 0;'
  = form_tag vendor_material_vendor_stocks_path, :method => 'get' do
    = month_field_tag :month,@month,class:"form-control",style:'width:200px;float:left;margin-right:10px;'
    = hidden_field_tag :vendor_id,params[:vendor_id]
    = submit_tag "表示" ,class:"btn btn-primary",style:'float:left;'
  - if current_user.admin == true
    = link_to "発注開始",new_order_path(vendor_id:774,store_id:39),class:'btn btn-primary',style:'float:right;',target:'_blank'

.table-responsive style='overflow: scroll;height:80vh;'
  table.table.layout-fixed style='border-collapse:separate;'
    thead style='position: sticky;top:0;background-color:white;z-index:3;'
      tr style="background-color:#ffffff;"
        th style="width:100px;border-right:1px solid #cccccc;" 日付
        - @materials.each do |material|
          th style="width:370px;border-right:1px solid #cccccc;"
            - name = "#{material.order_name}　1#{material.order_unit}：#{ActiveSupport::NumberHelper.number_to_rounded(material.recipe_unit_quantity/material.order_unit_quantity, strip_insignificant_zeros: true, :delimiter => ',', precision: 1)}#{material.recipe_unit}"
            - if current_user.admin == true
              = link_to name,edit_material_path(material),target:"_blank"
            - else
              = name
      tr style="background-color:#ffffff;"
        td style='border-right:1px solid #cccccc;'
        - @materials.each do |material|
          td style='border-right:1px solid #cccccc;'
            div.th_div 見込み
            div.th_div 発注量
            div.th_div 入庫
            div.th_div 出庫
            div.th_div 在庫
            div.th_div

    tbody
      - @dates.each do |date|
        - if date == @today
          - bg = "#ffc0cb"
        - else
          - bg = "#ffffff"
        tr style="background-color:#{bg};" class="tr_#{date}"
          td style='border-right:1px solid #cccccc;padding: 3px;' = "#{date.strftime("%-m/%-d(#{%w(日 月 火 水 木 金 土)[date.wday]})")}"
          - @materials.each do |material|
            - if date.day == 1
              - if @bom_hash[material.id].present?
                - @end_day_stock[material.id] = @bom_hash[material.id].end_day_stock
                - @previous_end_day_stock[material.id] = @bom_hash[material.id].previous_end_day_stock
              - else
                - if @prev_hash[material.id].present?
                  - @end_day_stock[material.id] = @prev_hash[material.id].end_day_stock
                  - @previous_end_day_stock[material.id] = @prev_hash[material.id].end_day_stock
                - else
                  - @end_day_stock[material.id] = 0
                  - @previous_end_day_stock[material.id] = 0
            td class="td_#{material.id}" style='border-right:1px solid #cccccc;padding: 3px;'
              = render partial: "td", locals: { date:date,material:material}

css:
  .table-responsive th {
      white-space: nowrap;
      background-color:white;
  }
  table.layout-fixed {
      table-layout: fixed;
      border-collspace:separate;
  }
  .table th:first-child,td:first-child{
      position: sticky;
      left: 0;
      text-align: right;
      background-color: inherit;
  }
  input{
    border:1px solid #cccccc;
    border-radius: 0.2em;
  }
  .th_div{
    text-align:center;
    float:left;width:60px
  }
  .td_div{
    text-align:center;
    float:left;
    width:60px;
  }