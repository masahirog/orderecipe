<% if @shinsei_flag == true %>
  <% if @shift.shift_pattern.present? %>
    $(".td_shinsei_<%= @shift.id %>").children(".shinsei_shift").text("<%= @shift.shift_pattern.pattern_name %>");
  <% else %>
    $(".td_shinsei_<%= @shift.id %>").children(".shinsei_shift").text("");
  <% end %>
<% else %>
  <% if @before_fix_shift_pattern.present? %>
    <% if @before_fix_shift_pattern.read_attribute_before_type_cast(:section) == 2 %>
      var lunch_count = $(".<%= @shift.date.day %>_store_<%= @before_store_id %>_section_0").text()
      lunch_count = Number(lunch_count) - 1;
      $(".<%= @shift.date.day %>_store_<%= @before_store_id %>_section_0").text(lunch_count);
      var dinner_count = $(".<%= @shift.date.day %>_store_<%= @before_store_id %>_section_1").text()
      dinner_count = Number(dinner_count) - 1;
      $(".<%= @shift.date.day %>_store_<%= @before_store_id %>_section_1").text(dinner_count);

      if (lunch_count < "<%= @before_store.lunch_default_shift %>") {
        $(".<%= @shift.date.day %>_store_<%= @before_store_id %>_section_0").css("background-color",'#f0c0c0 ');
      }else{
        $(".<%= @shift.date.day %>_store_<%= @before_store_id %>_section_0").css("background-color",'white');
      };

      if (dinner_count < "<%= @before_store.dinner_default_shift %>") {
        $(".<%= @shift.date.day %>_store_<%= @before_store_id %>_section_1").css("background-color",'#f0c0c0 ');
      }else{
        $(".<%= @shift.date.day %>_store_<%= @before_store_id %>_section_1").css("background-color",'white');
      };


    <% else %>
      var count = $(".<%= @shift.date.day %>_store_<%= @before_store_id %>_section_<%= @before_fix_shift_pattern.read_attribute_before_type_cast(:section) %>").text()
      count = Number(count) - 1;
      $(".<%= @shift.date.day %>_store_<%= @before_store_id %>_section_<%= @before_fix_shift_pattern.read_attribute_before_type_cast(:section) %>").text(count);
      if (count < "<%= @before_store.lunch_default_shift %>") {
        $(".<%= @shift.date.day %>_store_<%= @before_store_id %>_section_<%= @before_fix_shift_pattern.read_attribute_before_type_cast(:section) %>").css("background-color",'#f0c0c0 ');
      }else{
        $(".<%= @shift.date.day %>_store_<%= @before_store_id %>_section_<%= @before_fix_shift_pattern.read_attribute_before_type_cast(:section) %>").css("background-color",'white');
      };

    <% end %>
  <% end %>

  var val = 0
  var total = 0
  <% if @shift.fix_shift_pattern.present? %>
    <% if @shift.fix_shift_pattern.read_attribute_before_type_cast(:section) == 2 %>
      var lunch_count = $(".<%= @shift.date.day %>_store_<%= @shift.store_id %>_section_0").text();
      if (lunch_count=='0' || lunch_count=="") {
        $(".<%= @shift.date.day %>_store_<%= @shift.store_id %>_section_0").text(1);
      }else{
        lunch_count = Number(lunch_count) + 1;
        $(".<%= @shift.date.day %>_store_<%= @shift.store_id %>_section_0").text(lunch_count);
      }
      var dinner_count = $(".<%= @shift.date.day %>_store_<%= @shift.store_id %>_section_1").text();
      if (dinner_count=='0' || dinner_count=="") {
        $(".<%= @shift.date.day %>_store_<%= @shift.store_id %>_section_1").text(1);
      }else{
        dinner_count = Number(dinner_count) + 1;
        $(".<%= @shift.date.day %>_store_<%= @shift.store_id %>_section_1").text(dinner_count);
      }

      if (lunch_count < "<%= @shift.store.lunch_default_shift %>") {
        $(".<%= @shift.date.day %>_store_<%= @shift.store_id %>_section_0").css("background-color",'#f0c0c0 ');
      }else{
        $(".<%= @shift.date.day %>_store_<%= @shift.store_id %>_section_0").css("background-color",'white');
      };

      if (dinner_count < "<%= @shift.store.dinner_default_shift %>") {
        $(".<%= @shift.date.day %>_store_<%= @shift.store_id %>_section_1").css("background-color",'#f0c0c0 ');
      }else{
        $(".<%= @shift.date.day %>_store_<%= @shift.store_id %>_section_1").css("background-color",'white');
      };

    <% else %>
      var count = $(".<%= @shift.date.day %>_store_<%= @shift.store_id %>_section_<%= @shift.fix_shift_pattern.read_attribute_before_type_cast(:section) %>").text();
      if (count=='0' || count=="") {
        count = 1;
      }else{
        count = Number(count) + 1;
      }
      $(".<%= @shift.date.day %>_store_<%= @shift.store_id %>_section_<%= @shift.fix_shift_pattern.read_attribute_before_type_cast(:section) %>").text(count);
      if (count < "<%= @shift.store.lunch_default_shift %>") {
        $(".<%= @shift.date.day %>_store_<%= @shift.store_id %>_section_<%= @shift.fix_shift_pattern.read_attribute_before_type_cast(:section) %>").css("background-color",'#f0c0c0 ');
      }else{
        $(".<%= @shift.date.day %>_store_<%= @shift.store_id %>_section_<%= @shift.fix_shift_pattern.read_attribute_before_type_cast(:section) %>").css("background-color",'white');
      };
    <% end %>
    var working_hour = <%= @shift.fix_shift_pattern.working_hour %>
    $(".td_<%= @shift.id %>").find(".fix_shift_pattern").text("<%= @shift.fix_shift_pattern.pattern_name %>")
  <% else %>
    var working_hour = 0
    $(".td_<%= @shift.id %>").find(".fix_shift_pattern").text("")
  <% end %>
  $(".td_<%= @shift.id %>").find('.working_hour').val(working_hour);
  $(".fix_shift_tr_<%= @shift.staff_id %>").find('.working_hour').each(function(){
    val = Number($(this).val());
    total = total + val;
  });
  $(".working_hours_<%= @shift.staff_id %>").text(total);

  <% if @shift.store_id.present? %>
    <% if @shift.store_id == @shift.staff.store_id %>
      $(".td_<%= @shift.id %>").find(".fix_shift_select_store_id").css('background-color','#fffff');
    <% else %>
      $(".td_<%= @shift.id %>").find(".fix_shift_select_store_id").css('background-color','#90ee90');
    <% end %>
    <% if @shift.fix_shift_pattern_id.present? %>
      $(".td_<%= @shift.id %>").find(".fix_shift_select_select").css('background-color','white');
    <% else %>
      $(".td_<%= @shift.id %>").find(".fix_shift_select_select").css('background-color','pink');
    <% end %>
    $(".td_<%= @shift.id %>").find(".fix_store_name").text("<%= @shift.store.short_name %>")
  <% else %>
    <% if @shift.fix_shift_pattern_id.present? %>
      $(".td_<%= @shift.id %>").find(".fix_shift_select_store_id").css('background-color','pink');
    <% else %>
      $(".td_<%= @shift.id %>").find(".fix_shift_select_store_id").css('background-color','white');
    <% end %>
    $(".td_<%= @shift.id %>").find(".fix_store_name").text("")
  <% end %>
<% end %>
