<%= form_for @order do |f| %>
  <% if @order.errors.any? %>
    <div id="error_explanation">
      <b><%= pluralize(@order.errors.count, "箇所") %>入力に不備があります</b>
      <ul style="list-style:none;">
      <% @order.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <h4><%= f.label :delivery_date ,'納品日' %></h4>
  <div class="container form-group">
    <div class="col-md-12">
      <div class="col-md-4">
        <%= f.date_select :delivery_date,{}, class: "form-control col-md-2",style: "width:33%" %>
      </div>
      <div class="col-md-2 pull-right">
        <input type="button" onclick="submit();" value="発注確定する" class="order_submit btn btn-success">
      </div>
    </div>
  </div>

  <h4><strong>発注弁当</strong></h4>
  <ul class="list-group col-md-12">
    <% i = 0 %>
    <%= f.fields_for :order_products do |m| %>
      <li class="list-group-item col-md-12" style="padding:5px;">
        <%= m.text_field :product_id, class:'form-group col-md-2',style:"display:none;" %>
        <div class="col-md-5">
          <%= @order.products[i].name %>
        </div>
        <div class="col-md-3 form-inline">
          <%= m.text_field :serving_for, class:'form-control form-group',style:"width:70%;",readonly:true %>
        <div class="form-group">
          人分
        </div>
        </div>
      </li>
      <% i += 1 %>
    <% end %>
  </ul>

  <div class="col-md-12" style="padding-bottom:10px;">
    <div class="col-md-3">
      <strong>発注食材・資材一覧</strong>
    </div>

      <label class="col-md-2 text-right">企業絞込：</label>

    <div class="col-md-3">
      <select class="vendor_select form-control">
        <option value=""></option>
        <% @order.materials.select(:vendor_id).uniq.each do |v| %>
        <%= "<option value=#{v.vendor_id}>#{Vendor.find(v.vendor_id).company_name}</option>".html_safe %>
        <% end %>
      </select>
    </div>
    <div class="col-md-1 pull-right">
    </div>
  </div>

  <div class="orders_all table-responsive" style="width:1240px;">
  	<table class="table" style="" >
  		<thead>
        <tr style="padding:5px;">
          <th style="width:200px;">食材名</th>
          <th style="width:100px;">発注コード(検索時)</th>
          <th style="width:100px;" colspan="2">発注量</th>
          <th style="width:100px;" colspan="2">計算値</th>
          <th style="width:150px;">仕入先</th>
          <th style="width:200px;">単位変換</th>
          <th style="width250px;">
            <input type="checkbox" class="all_delete" style="width:24px;height:24px;margin:0;">発注無
          </th>
          <th style="width:450px;">備考欄</th>
        </tr>

  		</thead>
  		<tbody>
        <% i = 0 %>
        <%= f.fields_for :order_materials do |m| %>
          <tr class="order_materials_tr">
            <td class="order_material_name" style="width:200px;">
              <%= m.select :material_id, @materials.pluck(:name, :id),{include_blank: true}, class:'select_order_materials',style:"width:200px;"%>
            </td>
            <td class="order_code_search" style="width:100px;">
              <%= select_tag 'page[name]', options_from_collection_for_select(@search_code_materials, :id, :order_code),include_blank: true,class:"input_order_code" %>
            </td>
            <td class="order_quantity" style="width:120px;">
              <%= m.text_field :order_quantity,class:'text-right form-control',style:"height:27.78px;" %>
            </td>
            <td class="order_material_unit" style="padding:15px 0 0 0;">
              <%= @order.materials[i].order_unit %>
            </td>
            <td class="calculated_value" style="width:100px;">
              <%= m.text_field :calculated_quantity,class:'text-right form-control',
                style:"height:27.78px;",readonly:true %>
            </td>
            <td class="calculated_material_unit text-center" style="padding:15px 0 0 0;">
               <%= @order.materials[i].calculated_unit %>
            </td>
            <td class="vendor_company_name" style="width:120px;">
              <%= @order.materials[i].vendor.company_name %>
            </td>
            <td class="calculate_unit panel-title" style="width:200px;">
              1 <%= @order.materials[i].order_unit %>
              ：<%= @order.materials[i].calculated_value %> <%= @order.materials[i].calculated_unit %>
            </td>
            <td class="destroy_order_material" style=";width:150px;">
              <%= m.check_box :_destroy,class:"destroy_order_materials check_box",style:"width: 24px; height: 24px;margin:0;" %>
            </td>
            <td class="order_material_memo" style="width:200px;">
              <%= m.text_field :order_material_memo,class:'form-control',style:"width:250px;" %>
            </td>
          </tr>
        <% i = i + 1 %>
        <% end %>
  		</tbody>
  	</table>
  </div>


  <div class="add form-group">
    <input type="button" value="発注食材追加" class="add_order_materials btn btn-primary">
  </div>
<% end %>
