//= require rails-ujs
//= require jquery3
//= require jquery.turbolinks
//= require activestorage
//= require select2
//= require cocoon
//= require turbolinks
//= require Chart.min
//= require_tree .


$(document).on("turbolinks:before-cache", function() {
  $('.input_select_menu').select2('destroy');
  $('.kurumesi_order_select_product').select2('destroy');
  $('.input_select_product').select2('destroy');
  $('.input_select_food_additive').select2('destroy');
  $('.all_select_material').select2('destroy');
  $('.select_used_additives').select2('destroy');
  $('.all_select_menu').select2('destroy');
  $('.input_select_material').select2('destroy');
  $('.input_food_ingredient').select2('destroy');
  $('.select_order_materials').select2('destroy');
  $('.material_search').select2('destroy');
  $('.name_search').select2('destroy');
  $('.input-stock-materials-name').select2('destroy');
});

$(document).on('turbolinks:load', function() {
  var controller = $('body').data('controller');
  var action = $('body').data('action');

  $('.kurumesi_order_select_product').select2();
  $('.add_kurumesi_order_detail').on('click',function(){
    $('.kurumesi_order_select_product').select2('destroy');
    setTimeout(function(){
      $('.kurumesi_order_select_product').select2();
    },5);
  });

  $("#kurumesi_order_details_area").on('keyup','.kurumesi_order_details_product_number', function(){
    calculate_num();
  });

  $("#kurumesi_order_details_area").on('click','.remove_fields', function(){
    setTimeout(function(){
      calculate_num();
    },5);
  });
  function calculate_num(){
    var sum = 0;
    $('.kurumesi_order_details_tr:visible').each(function(i){
      sum += Number($(this).find('.kurumesi_order_details_product_number').val());
    });
    $('.kurumesi_order_sum_number').val(sum);
  }


})
function kanma (number) {
  var number = parseFloat(number);
  var number1 = number * 100;
  // //四捨五入したあと、小数点の位置を元に戻す
  number1 = Math.round(number1) / 100;
  var numData = number1.toString().split('.');
  // 整数部分を3桁カンマ区切りへ
  numData[0] = Number(numData[0]).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
  // 小数部分と結合して返却
  return numData.join('.');
};
